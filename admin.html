<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .container-admin { padding: 20px; max-width: 800px; margin: 0 auto; background: white; min-height: 100vh; }
        .header-admin { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-sair { background: red; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        
        /* Formul치rio de Adicionar */
        .form-add { background: #f4f4f4; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ddd; }
        .form-add input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .btn-salvar { background: #00C851; color: white; width: 100%; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }

        /* Lista de Itens */
        .item-lista { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        .item-info { flex-grow: 1; }
        .btn-remove { color: red; cursor: pointer; margin-left: 10px; }

        /* Caixa de C칩digo Final */
        .box-codigo { margin-top: 30px; background: #333; color: #00ff00; padding: 15px; border-radius: 5px; display: none; }
        .box-codigo textarea { width: 100%; height: 200px; background: #222; color: #fff; border: none; font-family: monospace; }
        .btn-gerar { background: var(--brown-dark); color: white; padding: 15px; width: 100%; border: none; font-size: 16px; cursor: pointer; border-radius: 8px; margin-top: 20px;}
    </style>
</head>
<body>

    <div class="container-admin">
        <div class="header-admin">
            <h2>Gerenciador de Card치pio 游닇</h2>
            <button class="btn-sair" onclick="sair()">Sair</button>
        </div>

        <div class="form-add">
            <h3>Adicionar Novo Produto</h3>
            <input type="text" id="novo-nome" placeholder="Nome do Produto (ex: Tapioca Doce)">
            <input type="text" id="novo-desc" placeholder="Descri칞칚o (ex: Coco com leite condensado)">
            <input type="number" id="novo-preco" placeholder="Pre칞o (ex: 15.00)">
            <input type="text" id="novo-img" placeholder="Link da Imagem (URL)">
            <button class="btn-salvar" onclick="adicionarItem()">Adicionar na Lista</button>
        </div>

        <h3>Itens Atuais:</h3>
        <div id="lista-admin">
            </div>

        <button class="btn-gerar" onclick="gerarCodigoFinal()">
            <i class="fa-solid fa-code"></i> FINALIZAR E GERAR C칍DIGO
        </button>

        <div class="box-codigo" id="area-codigo">
            <p>Copie o c칩digo abaixo e cole no seu arquivo <strong>cardapio.js</strong>:</p>
            <textarea id="codigo-resultado"></textarea>
            <button onclick="copiarTexto()" style="margin-top:10px; padding:5px;">Copiar C칩digo</button>
        </div>
    </div>

    <script src="cardapio.js"></script> 

    <script>
        // 1. Verifica Seguran칞a (Login)
        if (sessionStorage.getItem('logado') !== 'sim') {
            alert("Voc칡 precisa fazer login!");
            window.location.href = "login.html";
        }

        // Vari치vel local para editar o menu
        let menuEditavel = typeof menu !== 'undefined' ? menu : [];

        // 2. Renderiza a lista na tela
        function renderizarAdmin() {
            const container = document.getElementById('lista-admin');
            container.innerHTML = '';

            menuEditavel.forEach((item, index) => {
                container.innerHTML += `
                    <div class="item-lista">
                        <div class="item-info">
                            <strong>${item.nome}</strong> - R$ ${item.preco.toFixed(2)}<br>
                            <small>${item.descricao}</small>
                        </div>
                        <div class="acoes">
                            <i class="fa-solid fa-trash btn-remove" onclick="removerItem(${index})"></i>
                        </div>
                    </div>
                `;
            });
        }

        // 3. Adicionar Item
        function adicionarItem() {
            const nome = document.getElementById('novo-nome').value;
            const desc = document.getElementById('novo-desc').value;
            const preco = parseFloat(document.getElementById('novo-preco').value);
            const img = document.getElementById('novo-img').value || "https://via.placeholder.com/150";

            if (!nome || !preco) {
                alert("Preencha pelo menos nome e pre칞o!");
                return;
            }

            const novoId = menuEditavel.length > 0 ? menuEditavel[menuEditavel.length - 1].id + 1 : 1;

            const novoItem = {
                id: novoId,
                nome: nome,
                descricao: desc,
                preco: preco,
                imagem: img
            };

            menuEditavel.push(novoItem);
            renderizarAdmin();
            
            // Limpa campos
            document.getElementById('novo-nome').value = '';
            document.getElementById('novo-desc').value = '';
            document.getElementById('novo-preco').value = '';
        }

        // 4. Remover Item
        function removerItem(index) {
            if(confirm("Tem certeza que deseja apagar?")) {
                menuEditavel.splice(index, 1);
                renderizarAdmin();
            }
        }

        // 5. M치gica: Gerar o C칩digo JS
        function gerarCodigoFinal() {
            const caixa = document.getElementById('area-codigo');
            const textarea = document.getElementById('codigo-resultado');

            // Transforma o array em texto formatado
            const codigoJS = `const menu = ${JSON.stringify(menuEditavel, null, 4)};`;

            textarea.value = codigoJS;
            caixa.style.display = 'block';
            
            alert("C칩digo gerado! Copie o texto abaixo e substitua tudo no seu arquivo cardapio.js");
            window.scrollTo(0, document.body.scrollHeight);
        }

        function copiarTexto() {
            const copyText = document.getElementById("codigo-resultado");
            copyText.select();
            document.execCommand("copy");
            alert("C칩digo copiado! Agora v치 no arquivo cardapio.js, apague tudo e cole isso.");
        }

        function sair() {
            sessionStorage.removeItem('logado');
            window.location.href = "login.html";
        }

        // Inicia
        renderizarAdmin();
    </script>

</body>
</html>