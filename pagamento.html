<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento - Loucos Por Tapioca</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/imask"></script>
</head>
<body>

    <header class="header-carrinho">
        <a href="carrinho.html" class="btn-voltar">
            <i class="fa-solid fa-chevron-left"></i>
        </a>
        <span class="titulo-voltar">Finalizar</span>
        <div class="info-sacola">
            <span class="texto-sacola">Total</span>
            <span class="valor-sacola" id="valor-total-header">R$ 0,00</span>
        </div>
    </header>

    <main class="container-pagamento">
        
        <h3 class="titulo-secao"><i class="fa-regular fa-user"></i> Seus Dados</h3>
        
        <div class="box-input-animado">
            <label>Seu Nome:</label>
            <div class="input-icon">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="cliente-nome" placeholder="Como podemos te chamar?">
            </div>
        </div>

        <div class="box-input-animado">
            <label>Seu Telefone / WhatsApp:</label>
            <div class="input-icon">
                <i class="fa-brands fa-whatsapp"></i>
                <input type="tel" id="cliente-tel" placeholder="(81) 90000-0000">
            </div>
        </div>

        <div class="divisor"></div>

        <h3 class="titulo-secao"><i class="fa-solid fa-map-location-dot"></i> Entrega ou Retirada?</h3>
        
        <div class="grupo-opcoes">
            <label class="card-opcao">
                <input type="radio" name="entrega" value="entrega" checked onchange="toggleEndereco()">
                <div class="conteudo-card">
                    <div class="icone-card"><i class="fa-solid fa-motorcycle"></i></div>
                    <div class="texto-card">
                        <strong>Entrega</strong>
                        <p>Receber em casa</p>
                    </div>
                    <div class="check-icon"><i class="fa-solid fa-circle-check"></i></div>
                </div>
            </label>

            <label class="card-opcao">
                <input type="radio" name="entrega" value="retirada" onchange="toggleEndereco()">
                <div class="conteudo-card">
                    <div class="icone-card"><i class="fa-solid fa-bag-shopping"></i></div>
                    <div class="texto-card">
                        <strong>Retirada</strong>
                        <p>Buscar no local</p>
                    </div>
                    <div class="check-icon"><i class="fa-solid fa-circle-check"></i></div>
                </div>
            </label>
        </div>

        <div id="box-endereco" style="display:block;">
            
            <div class="box-input-animado">
                <label>Rua / Avenida:</label>
                <div class="input-icon">
                    <i class="fa-solid fa-road"></i>
                    <input type="text" id="end-rua" placeholder="Nome da rua">
                </div>
            </div>

            <div class="row-inputs">
                <div class="box-input-animado" style="flex: 1;">
                    <label>N√∫mero:</label>
                    <div class="input-icon">
                        <i class="fa-solid fa-hashtag"></i>
                        <input type="text" id="end-num" placeholder="N¬∫ ou S/N">
                    </div>
                </div>
                <div class="box-input-animado" style="flex: 2;">
                    <label>Bairro:</label>
                    <div class="input-icon">
                        <i class="fa-solid fa-map-pin"></i>
                        <input type="text" id="end-bairro" placeholder="Bairro">
                    </div>
                </div>
            </div>

            <div class="box-input-animado">
                <label>Ponto de Refer√™ncia (Opcional):</label>
                <div class="input-icon">
                    <i class="fa-regular fa-flag"></i>
                    <input type="text" id="end-ref" placeholder="Ex: Pr√≥ximo √† pra√ßa...">
                </div>
            </div>
        </div>

        <div class="divisor"></div>

        <h3 class="titulo-secao"><i class="fa-regular fa-credit-card"></i> Pagamento</h3>

        <div class="grupo-opcoes">
            <label class="card-opcao">
                <input type="radio" name="pagamento" value="pix">
                <div class="conteudo-card">
                    <div class="icone-card" style="color:#00bfa5;"><i class="fa-brands fa-pix"></i></div>
                    <div class="texto-card">
                        <strong>Pix</strong>
                        <p>Pagamento instant√¢neo</p>
                    </div>
                    <div class="check-icon"><i class="fa-solid fa-circle-check"></i></div>
                </div>
            </label>

            <label class="card-opcao">
                <input type="radio" name="pagamento" value="cartao" checked>
                <div class="conteudo-card">
                    <div class="icone-card" style="color:#2979ff;"><i class="fa-regular fa-credit-card"></i></div>
                    <div class="texto-card">
                        <strong>Cart√£o</strong>
                        <p>Leva a maquineta</p>
                    </div>
                    <div class="check-icon"><i class="fa-solid fa-circle-check"></i></div>
                </div>
            </label>

            <label class="card-opcao">
                <input type="radio" name="pagamento" value="dinheiro" onchange="toggleTroco()">
                <div class="conteudo-card">
                    <div class="icone-card" style="color:#4caf50;"><i class="fa-solid fa-money-bill-wave"></i></div>
                    <div class="texto-card">
                        <strong>Dinheiro</strong>
                        <p>Pagamento em esp√©cie</p>
                    </div>
                    <div class="check-icon"><i class="fa-solid fa-circle-check"></i></div>
                </div>
            </label>
        </div>

        <div id="box-troco" class="box-input-animado" style="display:none;">
            <label>Troco para quanto?</label>
            <div class="input-icon">
                <i class="fa-solid fa-hand-holding-dollar"></i>
                <input type="tel" id="troco-cliente" placeholder="Ex: 50,00">
            </div>
        </div>

    </main>

    <footer class="footer-pagamento">
        <button class="btn-finalizar" onclick="finalizarPedido()">
            Enviar Pedido via WhatsApp <i class="fa-brands fa-whatsapp"></i>
        </button>
    </footer>

    <script>
        const SEU_NUMERO = "5581991243260"; 

        // M√°scara para o telefone ficar bonito (Ex: (81) 9...)
        document.addEventListener('DOMContentLoaded', () => {
            const elPhone = document.getElementById('cliente-tel');
            IMask(elPhone, { mask: '(00) 00000-0000' });
            
            // Atualiza total
            const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            const total = carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            document.getElementById('valor-total-header').innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        });

        function toggleEndereco() {
            const tipo = document.querySelector('input[name="entrega"]:checked').value;
            const box = document.getElementById('box-endereco');
            box.style.display = (tipo === 'entrega') ? 'block' : 'none';
        }

        function toggleTroco() {
            const tipo = document.querySelector('input[name="pagamento"]:checked').value;
            const box = document.getElementById('box-troco');
            box.style.display = (tipo === 'dinheiro') ? 'block' : 'none';
        }
        
        // Monitora todos os radios de pagamento
        document.querySelectorAll('input[name="pagamento"]').forEach(r => r.addEventListener('change', toggleTroco));

        function finalizarPedido() {
            const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            if(carrinho.length === 0) return alert("Seu carrinho est√° vazio!");

            // Captura os dados
            const nome = document.getElementById('cliente-nome').value.trim();
            const telefone = document.getElementById('cliente-tel').value.trim();
            const entrega = document.querySelector('input[name="entrega"]:checked').value;
            const pagamento = document.querySelector('input[name="pagamento"]:checked').value;
            const troco = document.getElementById('troco-cliente').value;

            // Valida√ß√µes
            if(!nome) return alert("Por favor, digite seu Nome!");
            if(telefone.length < 14) return alert("Digite um telefone v√°lido com DDD!");

            let enderecoMsg = "";
            if(entrega === 'entrega') {
                const rua = document.getElementById('end-rua').value.trim();
                const num = document.getElementById('end-num').value.trim();
                const bairro = document.getElementById('end-bairro').value.trim();
                const ref = document.getElementById('end-ref').value.trim();

                if(!rua || !num || !bairro) return alert("Preencha o endere√ßo completo (Rua, N√∫mero e Bairro)!");
                
                enderecoMsg = `üè† *Endere√ßo de Entrega:*\n${rua}, N¬∫ ${num}\nBairro: ${bairro}`;
                if(ref) enderecoMsg += `\n(Ref: ${ref})`;
            } else {
                enderecoMsg = `üëú *Vou retirar no local*`;
            }

            // Monta o Pedido
            const total = carrinho.reduce((sum, i) => sum + (i.preco * i.quantidade), 0);
            const totalFormatado = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            let msg = `*NOVO PEDIDO - LOUCOS POR TAPIOCA* üåµ\n\n`;
            msg += `üë§ *Cliente:* ${nome}\n`;
            msg += `üìû *Tel:* ${telefone}\n\n`;
            msg += `*ITENS DO PEDIDO:*\n`;
            
            carrinho.forEach(i => {
                msg += `‚ñ™Ô∏è ${i.quantidade}x ${i.nome}\n`;
            });

            msg += `\nüí∞ *Valor Total: ${totalFormatado}*\n`;
            msg += `--------------------------------\n`;
            msg += `${enderecoMsg}\n`;
            msg += `--------------------------------\n`;
            msg += `üí≥ *Pagamento:* ${pagamento.toUpperCase()}\n`;
            if(pagamento === 'dinheiro' && troco) msg += `üíµ *Troco para:* ${troco}\n`;

            // Envia
            window.open(`https://wa.me/${SEU_NUMERO}?text=${encodeURIComponent(msg)}`, '_blank');
            
            // Limpa carrinho
            localStorage.removeItem('carrinho');
            window.location.href = "index.html";
        }
    </script>
</body>
</html>